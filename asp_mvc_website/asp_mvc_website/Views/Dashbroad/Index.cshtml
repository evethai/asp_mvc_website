@model List<OrderModel>
@{
    Layout = "/Views/Shared/_LayoutAd.cshtml";
}
<div class="page-content-wrapper">
    <div class="page-content">
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="breadcrumb-title pe-3">Dashboard</div>
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0 align-items-center">
                        <li class="breadcrumb-item">
                            <a href="javascript:;">
                                <ion-icon name="home-outline"></ion-icon>
                            </a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">eCommerce</li>
                    </ol>
                </nav>
            </div>
        </div>
        <div class="row row-cols-1 row-cols-lg-2 row-cols-xxl-4">
            <div class="col">
                <div class="card radius-10">
                    <div class="card-body">
                        <div class="d-flex align-items-start gap-2">
                            <div>
                                <p class="mb-0 fs-6" id="RevenueMonth">Total Revenue</p>
                            </div>
                            <div class="ms-auto widget-icon-small text-white bg-gradient-purple">
                                <ion-icon name="wallet-outline"></ion-icon>
                            </div>
                        </div>
                        <div class="d-flex align-items-center mt-3">
                            <div>
                                <h4 class="mb-0" id="RevenueShow"> 50</h4>
                            </div>
                            <div class="ms-auto">+6.32%</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="card radius-10">
                    <div class="card-body">
                        <div class="d-flex align-items-start gap-2">
                            <div>
                                <p class="mb-0 fs-6">Total Customer</p>
                            </div>
                            <div class="ms-auto widget-icon-small text-white bg-gradient-info">
                                <ion-icon name="people-outline"></ion-icon>
                            </div>
                        </div>
                        <div class="d-flex align-items-center mt-3">
                            <div>
                                <h4 class="mb-0">48,789</h4>
                            </div>
                            <div class="ms-auto">+12.45%</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="card radius-10">
                    <div class="card-body">
                        <div class="d-flex align-items-start gap-2">
                            <div>
                                <p class="mb-0 fs-6">Total Orders</p>
                            </div>
                            <div class="ms-auto widget-icon-small text-white bg-gradient-danger">
                                <ion-icon name="bag-handle-outline"></ion-icon>
                            </div>
                        </div>
                        <div class="d-flex align-items-center mt-3">
                            <div>
                                <h4 class="mb-0">@Model.ToList().Count()</h4>
                            </div>
                            <div class="ms-auto">+3.12%</div>
                        </div>
                    </div>
                </div>
            </div> <!-- Hoàn thành total Order -->
            <div class="col">
                <div class="card radius-10">
                    <div class="card-body">
                        <div class="d-flex align-items-start gap-2">
                            <div>
                                <p class="mb-0 fs-6">Conversion Rate</p>
                            </div>
                            <div class="ms-auto widget-icon-small text-white bg-gradient-success">
                                <ion-icon name="bar-chart-outline"></ion-icon>
                            </div>
                        </div>
                        <div class="d-flex align-items-center mt-3">
                            <div>
                                <h4 class="mb-0">48.76%</h4>
                            </div>
                            <div class="ms-auto">+8.52%</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-12 col-xl-8 d-flex">
                <div class="card radius-10 w-100">
                    <div class="card-body">
                        <div class="d-flex align-items-center mb-3">
                            <h6 class="mb-0">Earning Reports</h6>
                            <div class="dropdown options ms-auto">
                                <div class="dropdown-toggle dropdown-toggle-nocaret" data-bs-toggle="dropdown">
                                    <ion-icon name="ellipsis-horizontal-outline"></ion-icon>
                                </div>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="javascript:;">Action</a></li>
                                    <li><a class="dropdown-item" href="javascript:;">Another action</a></li>
                                    <li><a class="dropdown-item" href="javascript:;">Something else here</a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="row g-4 align-items-center mb-4">
                            <div class="col-12 col-xl-4">
                                <div class="d-flex align-items-center gap-2 mb-3">
                                    <h1 class="mb-0">$856</h1>
                                    <p class="mb-0 text-success bg-light-success px-2 rounded py-1">+10.6%</p>
                                </div>
                                <p class="mb-0">In publishing and graphic design, Lorem ipsum is a placeholder text commonly used to demonstrate.</p>
                            </div>
                            <div class="col-12 col-xl-8">
                                <div id="chart3"></div>
                            </div>
                        </div><!--end row-->
                        <div class="d-flex flex-column flex-lg-row align-items-lg-center align-self-end justify-content-lg-between border p-3 gap-3 mb-0 rounded-3">
                            <div class="d-flex align-items-center gap-3">
                                <div class="widget-icon rounded-circle bg-light-success text-success">
                                    <ion-icon name="card-outline"></ion-icon>
                                </div>
                                <div class="">
                                    <h4 class="mb-0">$95,286.50</h4>
                                    <p class="mb-0 text-secondary">Total Revenue</p>
                                </div>
                            </div>
                            <div class="vr d-none d-lg-block"></div>
                            <div class="d-flex align-items-center gap-3">
                                <div class="widget-icon rounded-circle bg-light-info text-info">
                                    <ion-icon name="diamond-outline"></ion-icon>
                                </div>
                                <div class="">
                                    <h4 class="mb-0">$58,820</h4>
                                    <p class="mb-0 text-secondary">Total Profit</p>
                                </div>
                            </div>
                            <div class="vr d-none d-lg-block"></div>
                            <div class="d-flex align-items-center gap-3">
                                <div class="widget-icon rounded-circle bg-light-purple text-purple">
                                    <ion-icon name="people-circle-outline"></ion-icon>
                                </div>
                                <div class="">
                                    <h4 class="mb-0">$26,498</h4>
                                    <p class="mb-0 text-secondary">Total Customer</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-12 col-xl-4 d-flex">
                <div class="card radius-10 overflow-hidden w-100">
                    <div class="card-body">
                        <div class="d-flex flex-column gap-3">
                            <div class="card border shadow-none radius-10 flex-grow-1 mb-0">
                                <div class="card-body">
                                    <div class="d-flex align-items-start gap-2">
                                        <div>
                                            <h5 class="mb-0 ">Total Accounts</h5>
                                        </div>
                                        <div class="ms-auto widget-icon-2 text-white bg-info rounded-circle">
                                            <ion-icon name="people-outline"></ion-icon>
                                        </div>
                                    </div>
                                    <div class="">
                                        <h3 class="mb-2">68,542</h3>
                                        <div class="d-flex align-items-center gap-2">
                                            <div class="widget-icon-small bg-light-danger text-danger">
                                                <ion-icon name="arrow-down-outline"></ion-icon>
                                            </div>
                                            <p class="mb-0">+9% last year</p>
                                        </div>
                                    </div>
                                    <div id="chart4"></div>
                                </div>
                            </div>
                            <div class="card border shadow-none radius-10 mb-0">
                                <div class="card-body">
                                    <div class="d-flex align-items-start gap-2">
                                        <div><p class="mb-0">Disk Space</p></div>
                                        <div class="dropdown options ms-auto">
                                            <div class="dropdown-toggle dropdown-toggle-nocaret" data-bs-toggle="dropdown">
                                                <ion-icon name="ellipsis-horizontal-outline"></ion-icon>
                                            </div>
                                            <ul class="dropdown-menu">
                                                <li><a class="dropdown-item" href="javascript:;">Action</a></li>
                                                <li><a class="dropdown-item" href="javascript:;">Another action</a></li>
                                                <li><a class="dropdown-item" href="javascript:;">Something else here</a></li>
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="d-flex align-items-center mt-3">
                                        <div>
                                            <h4 class="mb-3">48GB</h4>
                                            <div class="d-flex align-items-center gap-2">
                                                <div class="widget-icon-small bg-light-danger text-danger">
                                                    <ion-icon name="arrow-down-outline"></ion-icon>
                                                </div>
                                                <p class="mb-0">+7% last month</p>
                                            </div>
                                        </div>
                                        <div class="ms-auto">
                                            <div class="w_chart" id="chart5" data-percent="60">
                                                <span class="w_percent"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
@section Scripts {
    <script>
        setTimeout(() => {
            setInterval(() => {
                var date = new Date();
                var month = getMonthFromDate(date);
                $("#RevenueMonth").text("Total Revenues in " + month);
                checkPayment(month);
            }, 1000);
        }, 2000);
        function getMonthFromDate(date) {
            const monthIndex = date.getMonth();
            const month = monthIndex + 1;
            return month;
        }

        let isSuccess = false;
        async function checkPayment(month) {
            if (isSuccess) {
                return;
            } else {
                try {
                    const response = await fetch(
                        "https://script.google.com/macros/s/AKfycbzQ52rqTIhTS3VMlZ-N89XqSzDi6TDsnF9CdiBmX8bYqqwYmpk1bZRlIIwxSzS8Eh3fFw/exec"
                    );
                    const data = await response.json();
                    let totalRevenue = 0;
                    // Check if data is not empty
                    if (data.data && data.data.length > 0) {
                        var dataList = data.data;                
                        for (const item of dataList) {
                            const itemMonth = layThangFromDate(item["Ngày diễn ra"]);
                            const itemRevenue = item["Giá trị"];
                            if (itemMonth == month) {
                                totalRevenue += itemRevenue;
                            }
                        }
                        $("#RevenueShow").text(totalRevenue);
                    } else {
                        console.log("No data available.");
                    }
                } catch (error) {
                    console.log("Error fetching or processing data:", error);
                }
            }
        }

        // Function to calculate total revenue from a list of JSON objects
        function calculateTotalRevenueForList(dataList, targetMonth) {
            let totalRevenue = 0;

            for (const item of dataList) {
                const itemMonth = item["Ngày diễn ra"];
                const itemRevenue = item["Giá trị"];

                // Check if the item's month matches the target month
                if (itemMonth === targetMonth) {
                    totalRevenue += itemRevenue;
                }
            }
            return totalRevenue;
        }
        function layThangFromDate(dateString) {
            // Chuyển đổi chuỗi thành đối tượng Date
            var dateObject = new Date(dateString);

            // Lấy tháng từ đối tượng Date
            var thang = dateObject.getMonth() + 1; // Tháng bắt đầu từ 0, nên cần cộng thêm 1

            return thang;
        }
    </script>
}